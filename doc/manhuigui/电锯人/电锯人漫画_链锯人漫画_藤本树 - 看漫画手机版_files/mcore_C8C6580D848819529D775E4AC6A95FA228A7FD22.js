SMH=window.SMH||{};SMH={ver:"1.0.0",update:"2014/4/30",rootUrl:"/",ns:function(n){var t,i,r;if(!n||!n.length)return null;for(t=SMH,n=n.split("."),i=n[0]=="SMH"?1:0,r=n.length;i<r;i++)t[n[i]]=t[n[i]]||{},t=t[n[i]];return t},loginInfo:{status:0,nick_name:"",avatar:"",user_id:0,sex:1,is_loaded:0,login_url:location.protocol+"//www.manhuagui.com/user/login",auth:function(n){var t=this;t.is_loaded!=1?$.getJSON("/tools/submit_ajax.ashx?action=user_check_login&m=1",function(i){i.status==1&&$.extend(t,i);t.is_loaded=1;n()}):n()}}};SMH.utils=function(n,t,i){return{head:i.getElementsByTagName("head")[0]||i.documentElement,isMobile:/(Android|webOS|iPhone|Windows Phone|iPod|BlackBerry|SymbianOS)/i.test(navigator.userAgent),isTouch:"createTouch"in i,ticks:+new Date,isInViewport:function(n){var r=n.getBoundingClientRect();return r.top>=0&&r.left>=0&&r.bottom<=(t.innerHeight||i.documentElement.clientHeight)&&r.right<=(t.innerWidth||i.documentElement.clientWidth)},getQuery:function(n){var t=RegExp("[#&]"+n+"=([^&]*)").exec(window.location.hash);return t?decodeURIComponent(t[1].replace(/\+/g," ")):""},cookie:function(){function t(t,i,r){var e,u,o,s,f,h;if(typeof i!="undefined"){r=r||{};i===null&&(i="",r.expires=-1);e="";r.expires&&(typeof r.expires=="number"||r.expires.toUTCString)&&(typeof r.expires=="number"?(u=new Date,u.setTime(u.getTime()+r.expires*864e5)):u=r.expires,e="; expires="+u.toUTCString());var c=r.path?"; path="+r.path:"",l=r.domain?"; domain="+r.domain:"",a=r.secure?"; secure":"";document.cookie=[t,"=",encodeURIComponent(i),e,c,l,a].join("")}else{if(o=null,document.cookie&&document.cookie!="")for(s=document.cookie.split(";"),f=0;f<s.length;f++)if(h=n.trim(s[f]),h.substring(0,t.length+1)==t+"="){o=decodeURIComponent(h.substring(t.length+1));break}return o}}return{set:function(n,i,r){r=r||{expires:365,path:"/"};t(n,i,r)},get:function(n){return console.log("aaa"),t(n)},remove:function(n){t(n,null,{expires:-1,path:"/"})},clear:function(){for(var r=document.cookie.split(";"),t,u,i=0,f=r.length;i<f;i++)t=n.trim(r[i]),u=t.substring(0,t.indexOf("=")),this.remove(u)}}}(),storage:function(){var t=this,n=function(){try{return localStorage in window&&window.localStorage}catch(n){return!1}}();return{get:function(t){return n?localStorage.getItem(t):SMH.utils.cookie.get(t)},set:function(t,i){n?localStorage.setItem(t,i):SMH.utils.cookie.set(t,i)},remove:function(t){n?localStorage.removeItem(t):SMH.utils.cookie.remove(t)},clear:function(){n?localStorage.clear():SMH.utils.cookie.clear()}}}()}}(window.jQuery||window.Zepto,window,window.document);SMH.popup=function(){var n={ids:["#category","#history","#search","#shelf"],cls:["icon-list-on","icon-history-on","icon-search-on","icon-shelf-on"],pops:["#popCat","#popHistory","#popSearch","#popShelf"]},t=n.ids.length;return{hideAll:function(){for(var i=0;i<t;i++)$(n.ids[i]).removeClass(n.cls[i]),$(n.pops[i]).hide()},bind:function(){for(var r=this,i=0;i<t;i++)(function(t){var f=n.ids[t],i=n.cls[t],u=n.pops[t];$(f).click(function(){$(this).hasClass(i)?($(this).removeClass(i),$(u).hide()):(r.hideAll(),$(this).addClass(i),$(u).show())})})(i)}}}();SMH.history=function(){function t(n){var i=n*1e3,r=new Date(i),o=new Date,s=Date.parse(o.toDateString()),e=o.getTime(),h=36e5,u=0,f=function(n){return n<10?"0"+n:n},t=[];if(s>i){u=Math.ceil((s-i)/864e5);switch(u){case 1:t.push("昨天 ");break;case 2:t.push("前天 ");break;default:t.push(f(r.getMonth()+1),"月",f(r.getDate()),"日")}t.push(f(r.getHours())+":"+f(r.getMinutes()))}else e-i<6e4?(u=Math.ceil((e-i)/1e3),t.push(u,"秒前")):(u=Math.ceil((e-i)/h),u==1?t.push(Math.floor((e-i)%h/6e4),"分钟前"):t.push("今天 ",f(r.getHours()),":",f(r.getMinutes())));return t.join("")}var n={maxLen:30,len:0,cname:"viewed",cvalue:[],got:!1,init:!1};return{get:function(){if(n.got===!1){var t=SMH.utils.storage.get(n.cname);t=typeof t!="string"?undefined:JSON.parse(t);t&&$.each(t,function(){n.cvalue.push(this);n.len++});n.got=!0}},add:function(t){this.get();t!=null&&typeof t!="undefined"&&($.each(n.cvalue,function(i){if(this.bid==t.bid)return n.cvalue.splice(i,1),n.len--,!1}),n.cvalue.push(t),n.len++,n.len>n.maxLen&&(n.cvalue.splice(0,n.len-n.maxLen+1),n.len=n.maxLen));n.cvalue.length>0&&SMH.utils.storage.set(n.cname,JSON.stringify(n.cvalue))},remove:function(t,i){if(n.cvalue.splice(t,1),n.len--,n.len<=0?SMH.utils.storage.remove(n.cname):SMH.utils.storage.set(n.cname,JSON.stringify(n.cvalue)),$(i).hide(200),n.len<=0){$(".vr-list").html("暂时没有观看记录!");return}},clear:function(){SMH.utils.storage.remove(n.cname);n.len=0;n.cvalue=[];$(".vr-list").html("暂时没有观看记录!")},init:function(){var t=this;$("#history").click(function(){n.init==!1&&t.format()})},format:function(){var i,r,u;this.get();n.init=!0;i=[];n.len>0&&$.each(n.cvalue,function(r,u){var f=[];f.push('<li rel="'+r+'"><h5><dfn><a href="/comic/'+u.bid+'/">'+u.bn+'<\/a> <em>/<\/em> <a href="/comic/'+u.bid+"/"+u.cid+'.html" class="red">'+u.cn+"<\/a><\/dfn>");r==n.cvalue.length-1?f.push("<span>正在浏览观看……<\/span>"):f.push("<span>上次于 "+t(u.t)+" 观看<\/span>");f.push("<\/h5>");f.push('<p><b><a href="/comic/'+u.bid+"/"+u.cid+".html"+(u.p==1?"":"#p="+u.p)+'">继续观看<i class="iconfont">&#xe626;<\/i><\/a><\/b><\/p>');f.push("<\/li>");i.push(f.join(""))});r=this;u=n.len;u==0?$(".vr-list").html("暂时没有观看记录!"):($(".vr-list").html(i.reverse().join("")),$(".vr-empty a").click(function(){return r.clear(),!1}),$(".vr-list li").swipeLeft(function(){r.remove($(this).attr("rel"),this)}))}}}();SMH.suggest=function(){function h(n,t){var r=[];for(var i in n)r.push("<li"),r.push(' title="'+n[i].t+'" data-url="'+n[i].u+'"">'),r.push('<a href="'+n[i].u+'">'+(n[i].t+"["+n[i].a+"]").replace(new RegExp("("+t+")","gi"),"<strong>$1<\/strong>")+"<\/a> "),r.push(n[i].s?"<em>已完结<\/em>":"<span>"+n[i].ct+"<\/span>"),r.push("<\/li>");return r.join("")}function f(t,r){var f=typeof t=="object"?h(t,r):t;n.html("<ul>"+f+"<\/ul>");u=n.find("li").length;t.length>0?(n.show(),i[r]=f,i.length>20&&i.pop()):n.hide()}function c(n){i[n]?f(i[n],n):$.ajax({type:"POST",url:l,data:{key:n,s:1},dataType:"json",success:function(t){f(t,decodeURIComponent(n))}})}function e(){r&&clearTimeout(r);r=window.setTimeout(function(){var i=$.trim(t.val());s!=i&&(s=i,i!=""?c(encodeURIComponent(i)):(u=0,n.hide().html("")))},delay)}var l="/tools/word.ashx",r=null,i=[],u=0,t,o,n,s;return{check:function(){var n=$.trim(t.val());if(n=="")return t.focus(),window.alert("请输入漫画名称"),!1;window.location.href=SMH.rootUrl+"s/"+n+".html"},init:function(i){var f=this,r={input:"#txtKey",submit:"#btnSubmit",delay:100,result:"#suggest"};$.extend(r,i);delay=r.delay||200;t=$(r.input);o=$(r.submit);n=$(r.result);t.focus(function(){u>0&&n.show()}).keypress(function(n){n.stopPropagation();e()}).keyup(function(n){return n.stopPropagation(),n.keyCode===13&&f.check(),!1});t.on("input",function(n){n.stopPropagation();e()});o.click(function(){f.check()})}}}();SMH.shelf=function(){function t(n){return"/tools/submit_ajax.ashx?action="+(n?"user_book_shelf_delete":"user_book_shelf_add")}var n={checked:0,init:0,id:0};return{get:function(i){n.checked||$.getJSON("/tools/submit_ajax.ashx?action=user_book_shelf_check",{book_id:i},function(r){$("#popShelf .msg").text("共"+r.total+"位会员收藏到书架").show();$("#popShelf ul").append($("<li><a>"+(r.status?"从书架移除":"加入书架")+"<\/a><\/li>").click(function(){$.post(t(r.status),{book_id:i},function(n){window.alert(n.msg);location.reload()},"json")}));n.checked=1})},init:function(){var t=this;$("#shelf").click(function(){SMH.loginInfo.auth(function(){n.init!=1&&(SMH.loginInfo.status?($("#popShelf ul").append($('<li><a href="/user/book/shelf">查看书架<\/a><\/li>')),typeof chapterInfo!="undefined"&&t.get(chapterInfo.bid)):($("#popShelf .msg").text("对不起，您尚未登录，无法使用此功能！").show(),$("#popShelf ul").append($('<li><a href="'+SMH.loginInfo.login_url+'">现在登录<\/a><\/li>')).append($('<li><a href="javascript:void(0)">以后再说<\/a><\/li>').click(function(){SMH.popup.hideAll()}))),n.init=1)})})}}}();SMH.reader=function(n,t){return function(i){function f(){var n=t.getQuery("p");return n=n<=0?1:n>=r.count?r.count:n,parseInt(n,10)}function e(n){var u=location.protocol+"//"+r.host+".hamreus.com"+r.images[n],t=[];for(var i in r.sl)t.push(i+"="+r.sl[i]);return u+(t.length>0?"?"+t.join("&"):"")}function o(t){for(var i=r.page;i<r.page+t;i++){if(i>r.count)break;n("<img />")[0].src=e(i)}}var r=n.extend({host:"i",host_i:0,bookId:0,chapterId:0,count:0,images:[],page:1,status:1,retry:0,block_cc:"CN",panel:{container:"#panel",prev:"#prev",next:"#next"},container:{manga:"#manga",loading:"#loading",pageNo:"#pageNo",action:"#action"}},i),s=(window.innerHeight||document.documentElement.clientHeight)-156,u=SMH.picserv;return{panelBind:function(){var i=this;if(t.cookie.get("panel")==1){n(r.panel.next).on("click",function(){i.next()});n(r.panel.prev).on("click",function(){i.prev()})}else{n(r.panel.next).addClass("manga-panel-on").html("<span>下一页<\/span>");n(r.panel.prev).addClass("manga-panel-on").html("<span>上一页<\/span>");n(r.panel.container).one("click",function(t){t.preventDefault();n(r.panel.next).removeClass("manga-panel-on").empty().on("click",function(){i.next()});n(r.panel.prev).removeClass("manga-panel-on").empty().on("click",function(){i.prev()})});t.cookie.set("panel",1,{expires:1,path:"/"})}$(window).scroll()},load:function(){var i=this;n(r.container.pageNo).text(r.page);n(r.container.manga).find("img").remove();n(r.container.loading).text("图片努力载入中...").show();n('<img width="100%" src="'+e(r.page-1)+'" />').on("load",function(){n(r.container.loading).hide();r.retry>0&&t.cookie.set("imgHost",r.host_i,{expires:7,path:"/"});o(1)}).on("error",function(){r.retry<u.getLiveHostsLen()-1?(r.host_i=u.getNextTry(),r.host=u.getHostName(r.host_i),i.load()):(n(this).hide(),n(r.container.loading).text("图片载入失败！").show());r.retry++}).appendTo(r.container.manga).show("fast");setTimeout(function(){SMH.history.add({bn:r.bookName,bid:r.bookId,cn:r.chapterTitle,cid:r.chapterId,p:r.page,t:parseInt((new Date).getTime()/1e3)})},1e3)},preInit:function(){if(r.images.length>0){var n=$(r.panel.container);n.hide();SMH.adult.init({status:r.status,block_cc:r.block_cc},function(){$("#erroraudit_show").remove();n.show();SMH.reader(r).init()})}},init:function(){var e=document.createElement("canvas"),o=e.getContext&&e.getContext("2d")&&e.toDataURL("image/webp").indexOf("data:image/webp")==0,i;o||$.each(r.images,function(n,t){r.images[n]=t.replace(/(.*)\.webp$/gi,"$1")});u.init(0);r.host_i=t.cookie.get("imgHost");u.isdown(r.host_i)&&(r.host_i=u.getCurHost());r.host=u.getHostName(r.host_i);r.page=f();i=this;i.load();i.panelBind();n(r.container.manga).css("min-height",s);window.onhashchange=function(){r.page=f();i.load();try{$("[id^=boluo_adContainer] iframe").attr("src",function(n,t){return t})}catch(n){}};n(r.container.action).find("a").each(function(){n(this).bind("click",function(){switch(n(this).attr("data-action")){case"next":i.next();break;case"prev":i.prev();break;case"chapter.next":i.chapter(r.bookId,r.chapterId).next();break;case"chapter.prev":i.chapter(r.bookId,r.chapterId).prev()}})})},next:function(){r.page++;r.page>r.count?this.chapter(r.bookId,r.chapterId).next():window.location.hash="#p="+String(r.page)},prev:function(){r.page--;r.page<=0?this.chapter(r.bookId,r.chapterId).prev():window.location.hash="#p="+String(r.page)},chapter:function(n){function t(t){setTimeout(function(){t===1?r.nextId==0?(r.page--,window.alert("没有下一章了")):location.href="/comic/"+n+"/"+r.nextId+".html":r.prevId==0?(r.page++,window.alert("没有上一章了")):location.href="/comic/"+n+"/"+r.prevId+".html"},2e3)}return{next:function(){t(1)},prev:function(){t(0)}}}}}}(window.jQuery||window.Zepto,SMH.utils);SMH.comment=function(){function r(){for(var n,t=0;t<10;t++)$(".newsAll ul li.hide").first().addClass("li_fadeInUp").removeClass("hide");if($("#loading").removeClass("loading_more").html("点击查看更多"),n=$(".newsAll ul li.hide").length,n<=20&&n>10)$(window).on("scroll",s);if(n<=10&&n!=0)$(window).on("scroll",h);if(n==0)$("#loading").on("click",a)}function f(){var n=$(window).width(),t=n-112,i=n-80;$(".focus").width(t);$(".comment_main").width(i)}function c(){$(".newsHot ul li").first().find(".comment_main").css({"border-top":0});$(".newsAll ul li").first().find(".comment_main").css({"border-top":0})}function a(){$("#loading").addClass("loading_more").html('<img src="'+n+'/images/mobile/loading.gif"/>').off("click");o()}var n=location.protocol+"//cf.mhgui.com",t=0,e=1,i=[],u={},o=function(){$.getJSON("/tools/submit_ajax.ashx?action=comment_list&m=1",{book_id:t,page_index:e},function(t){var k,v,y,p,b,a,h;if(t.total==0)return $(".newsAll ul").append("<div style='width:100%;text-align:center;padding-top: 20px;float:left;'>暂无更多评论<\/div>"),$("#loading").remove(),!1;for($("#review em").html("("+t.total+")"),$(".review_btm .fl span").html(t.total),$(".fl span").html()==0&&(f(),k=$(".newsHot"),k.next(".partLine").remove(),k.remove(),$("#loading").remove(),$(".newsAll ul").append("还没有评论，快来抢占沙发吧！")),v=[],y=t.comments,$.each(t.commentIds,function(n,t){i.indexOf(t)<0&&(i.push(t),v.push(t))}),$.extend(u,y),p=0;p<v.length;p++){var w=v[p].split(","),g=w[0],s=y[g],d=s.id,l="0"+s.user_id+s.add_time+s.id+"0",o="";if(o+='<li class="hide"><div class="auimg"><img src="'+s.avatar+'" class="user_img" onerror="this.src=\''+n+"/images/default.png'\">",o+='<\/div><div class="comment_main"><span class="user_name">'+s.user_name+"<\/span>",s.sex&&(o+='<img src="'+n+"/images/mobile/sex_"+s.sex+'.png" class="sex">'),o+='<div class="com_container">',w.length>1){for(b=w.slice(1),b.reverse(),o+='<div class="masterCom">',a=0;a<b.length;a++)h=y[b[a]],h.content.length>100?(o+='<div class="lou" name="'+l+'"><p class="hei"><span><em>'+h.user_name+'<\/em>：<\/span><span class="replyLou" onclick="SMH.comment.reply(this,'+h.user_id+","+h.id+","+d+')">',o+=""+h.content+'<\/p><span class="qw" onclick="SMH.comment.opentext(this)">显示全文<\/span>'):h.content==""?o+='<div class="lou" name="'+l+'"><p>此评论已被删除<\/p>':(o+='<div class="lou" name="'+l+'"><p><span><em>'+h.user_name+'<\/em>：<\/span><span class="replyLou" onclick="SMH.comment.reply(this,'+h.user_id+","+h.id+","+d+')">',o+=""+h.content+"<\/p>"),o+='<div class="masterNum">'+(a+1)+"<\/div><\/div>";o+="<\/div>"}o+=s.content.length>100?'<p class="hei">'+s.content+'<\/p><span class="qw" onclick="SMH.comment.opentext(this)">显示全文<\/span>':"<p>"+s.content+"<\/p>";o+="<\/div>";o+='<span class="user_time">'+s.add_time+"<\/span>";o+='<span class="review" onclick="SMH.comment.reply(this,'+s.user_id+","+s.id+","+d+')">'+s.reply_count+"<\/span>";o+='<span class="praise" onclick="SMH.comment.agree(this,'+s.id+')">'+s.support_count+"<\/span><\/div><\/li>";$(".newsAll ul").append(o);w.length-1>3&&($("div.lou[name='"+l+"']").hide().last().before('<div class="show_morelou" onclick="SMH.comment.moreLou(this)">展开隐藏次元<\/div>'),$("div.lou[name='"+l+"']:first").show(),$("div.lou[name='"+l+"']:last").show());f();c()}e++;r()})},s=function(){var t=$(document).height();$(window).scrollTop()+$(window).height()>=t-150&&($(".n_more_btm").addClass("loading_more").html('<img src="'+n+'/images/mobile/loading.gif"/>'),$(window).off("scroll",s),setTimeout(function(){r()},800))},h=function(){var t=$(document).height();$(window).scrollTop()+$(window).height()>=t-150&&($(".n_more_btm").addClass("loading_more").html('<img src="'+n+'/images/mobile/loading.gif"/>'),$(window).off("scroll",h),setTimeout(function(){r()},800))},l=function(t){var h=t.id,s="0"+t.user_id+t.add_time+t.id+"0",e="",o;e+='<li class="hide"><div class="auimg"><img src="'+t.avatage+'" class="user_img" onerror="this.src=\''+n+"/images/default.png'\">";e+='<\/div><div class="comment_main"><span class="user_name">'+t.user_name+"<\/span>";t.sex&&(e+='<img src="'+n+"/images/mobile/sex_"+t.sex+'.png" class="sex">');e+='<div class="com_container">';o=[];t.parent_id>0&&(h=t.parent_id,$.each(i,function(n,i){var l=i.split(","),a,c,f,r;if(l[0]==t.origin_comment_id+""&&(a=l.indexOf(h+""),a>=0)){for(c=l.slice(a),c.reverse(),e+='<div class="masterCom">',f=0;f<c.length;f++)r=u[c[f]],r.content.length>100?(e+='<div class="lou" name="'+s+'"><p class="hei"><span><em>'+r.user_name+'<\/em>：<\/span><span class="replyLou" onclick="SMH.comment.reply(this,'+r.user_id+","+r.id+","+t.id+')">',e+=""+r.content+'<\/p><span class="qw" onclick="SMH.comment.opentext(this)">显示全文<\/span>'):(e+='<div class="lou" name="'+s+'"><p><span><em>'+r.user_name+'<\/em>：<\/span><span class="replyLou" onclick="SMH.comment.reply(this,'+r.user_id+","+r.id+","+t.id+')">',e+=""+r.content+"<\/p>"),e+='<div class="masterNum">'+(f+1)+"<\/div><\/div>",o.push(c[f]);e+="<\/div>"}}));o.push(t.id+"");o.reverse();i.push(o.join(","));u[t.id]=t;e+=t.content.length>100?'<p class="hei">'+t.content+'<\/p><span class="qw" onclick="SMH.comment.opentext(this)">显示全文<\/span>':"<p>"+t.content+"<\/p>";e+="<\/div>";e+='<span class="user_time">'+t.add_time+"<\/span>";e+='<span class="review" onclick="SMH.comment.reply(this,'+t.user_id+","+t.id+","+t.id+')">0<\/span>';e+='<span class="praise" onclick="SMH.comment.agree(this,'+t.id+')">0<\/span><\/div><\/li>';$(".newsAll ul").prepend(e);o.length-1>3&&($("div.lou[name='"+s+"']").hide().last().before('<div class="show_morelou" onclick="SMH.comment.moreLou(this)">展开隐藏次元<\/div>'),$("div.lou[name='"+s+"']:first").show(),$("div.lou[name='"+s+"']:last").show());f();c();r();$(".newsAll ul li").eq(1).find(".comment_main").css({"border-top":"1px solid #cbcbcb"})};return{opentext:function(n){$(n).hide().siblings("p.hei").removeClass("hei")},moreLou:function(n){$(n).hide().siblings("div.lou").show()},reply:function(n,i,r,u){SMH.loginInfo.auth(function(){function c(){var h=$("a#submit").html(),o=encodeURIComponent($.trim($("textarea[name=textareadiv]").val()));if(o=="")return alert("评论不能为空"),!1;$("a#submit").off("click").html("发表中..");var a=i==0?0:i,e=r==0?0:r,s=u;$.post("/tools/submit_ajax.ashx?action=comment_add&m=1",{book_id:t,txtContent:o,to_comment_id:e},function(t){var r,i,u;if(t.status)$("li.add_img").show().siblings("li.tableCell").remove(),$("input#hiddenInput").val(""),$("textarea[name=textareadiv]").val(""),$(".review_pop,.mask").hide(),$("#replyeff").show().html(t.msg+"!"),setTimeout(function(){$("#replyeff").hide();f.show()},2e3),l({id:t.comment_id,user_name:SMH.loginInfo.nick_name,user_id:SMH.loginInfo.user_id,avatage:SMH.loginInfo.avatar,sex:SMH.loginInfo.sex,content:decodeURIComponent(o),parent_id:e,add_time:(new Date).Format("yyyy-MM-dd hh:mm:ss"),support_count:0,origin_comment_id:s}),e!=0&&s==e&&(r=parseInt($(n).html()),$(n).html(r+1)),i=$(".fl span"),u=parseInt(i.html()),i.html(u+1);else{alert(t.msg);$("a#submit").html(h);$("a#submit").on("click",c)}},"json")}var h,f,e,o,s;if(SMH.loginInfo.status==0)return alert("您必须登录后才能评论"),window.location.href=SMH.loginInfo.login_url,!1;$(".reply_").remove();h="true";f=$(".news_content iframe");f.hide();i!=0&&(e="",$(n).hasClass("replyLou")?(o=$(n).siblings("span").children("em").text(),s=$(n).text()):(o=$(n).siblings(".user_name").text(),s=$(n).siblings("div.com_container").children("p").text()),e+="<div class='reply_'>回复<em>"+o+"<\/em>："+s+"<\/div>",$(".review_pop").prepend(e));$(".mask,.review_pop").show();$("a#submit").html("发表回复");$("a#cancel").html("取消回复");$("textarea").focus();$("a#submit").on("click",c);$("#cancel").on("click",function(){$("#submit").off("click");$(".text_length span").html("0");$("li.tableCell").remove();$("li.add_img").show();$("input#hiddenInput").val("");$("textarea[name=textareadiv]").val("");$(".review_pop,.mask").hide();h="false";f.show()})})},agree:function(n,t){var i=$(n).html();$.getJSON("/tools/submit_ajax.ashx?action=comment_support",{comment_id:t},function(t){t.status==1&&($(n).html(parseInt(i)+parseInt(1)),$(n).addClass("cur").attr("onclick",""))})},init:function(){if(typeof chapterInfo!="undefined"&&chapterInfo!=null&&(t=chapterInfo.bid),$("#Comment_m_Box").length==0||t==0){console.log("无评论载入div");return}var i='<div class="newsmain_review" id="Comment_main"> <a name="comm"><\/a><div class="newsAll"><h3 class="comment_til">最新评论<\/h3><ul> <\/ul> <\/div><\/div><div class="review_btm"><div class="fl" style="position:relative;width:75px;height:45px;display:inline-block;float:left;"><a href="#comm"><img src="'+n+'/images/mobile/review3.png" height="16" width="21"><span>0<\/span><\/a><\/div><div class="fl focus" style="position:relative;float:left;">吐槽来一发...<\/div><\/div><div class="hide" id="replyeff">发表成功 !<\/div><div class="mask hide"><\/div><div class="review_pop hide"><textarea maxlength="1000" name="textareadiv"><\/textarea><div class="visiblity">请输入评论内容...<\/div><div class="text_length"><span>0<\/span>/1000字<\/div><div class="icon_com hide"><img src="'+n+'/images/mobile/icon_com_1.png" height="22" width="22"><img src="'+n+'/images/mobile/icon_com_2.png" height="22" width="22"><img src="'+n+'/images/mobile/icon_com_3.png" height="22" width="22"><\/div><div class="submit"><a id="cancel">取消回复<\/a><a id="submit">发表回复<\/a><\/div><\/div>';$("#Comment_m_Box").html(i);o();$(".focus").on("click",function(){SMH.comment.reply(this,0,0,0);$("a#submit").html("发布");$("a#cancel").html("取消")});$(".review_pop textarea").on("focus",function(){$(".visiblity").hide()});$(".visiblity").on("click",function(){$(this).hide();$(".review_pop textarea").focus()});$(".review_pop textarea").on("input",function(){var n=$(".review_pop textarea").val().length;$(".review_pop .text_length span").html(n)});$(".add_img").on("click",function(){$("#fileupload").click()});$(".newsAll").append('<a class="n_more_btm" id="loading">点击查看更多<\/a>')}}}();SMH.adult=function(n){function f(){var n=i!=null&&t.block_cc.indexOf(i)<0,r=!navigator.cookieEnabled&&t.block_cc=="";return n||r}function u(t){f()&&($("#checkAdult").length>0&&!n.get(r)?$("#checkAdult").click(function(){try{n.set(r,1,{expires:7,path:"/"})}catch(i){}t()}).show():t())}var i=n.get("country"),r="isAdult",t={status:1,block_cc:""};return{init:function(r,f){$.extend(t,r);typeof t!="undefined"&&t!=null&&(i!=null?u(f):SMH.loginInfo.auth(function(){i=n.get("country");u(f)}))}}}(SMH.utils.cookie);$("#__VIEWSTATE").length>0&&$("#erroraudit_show").length>0&&SMH.adult.init(chapterInfo,function(){var n=LZString.decompressFromBase64($("#__VIEWSTATE").val());n!=""&&($("#erroraudit_show").replaceWith(n),$("#__VIEWSTATE").remove())});$(function(){new FastClick(document.body);SMH.popup.bind();SMH.suggest.init();SMH.history.init();SMH.shelf.init();SMH.comment.init();$("#toPC").click(function(){SMH.utils.cookie.set("fromMobile",1,{expires:1,path:"/",domain:".manhuagui.com"});var n=window.location.href.toLowerCase();window.location.href=n.replace("m.manhuagui.com","www.manhuagui.com")})});Date.prototype.Format=function(n){var i={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()},t;/(y+)/.test(n)&&(n=n.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(t in i)new RegExp("("+t+")").test(n)&&(n=n.replace(RegExp.$1,RegExp.$1.length==1?i[t]:("00"+i[t]).substr((""+i[t]).length)));return n};
SMH.picserv=function(){function f(n){for(var i=[n[0].w],r,t=1;t<n.length;t++)i[t]=n[t].w+i[t-1];for(r=Math.random()*i[i.length-1],t=0;t<i.length;t++)if(i[t]>r)break;return t}function u(t){var r=Math.floor(Math.random()*n.length);return t.indexOf(r)>=0?u.apply(this,arguments):(i.push(r),r)}var t=[{name:"自动",hosts:[{h:"i",w:.1},{h:"eu",w:4},{h:"eu1",w:4},{h:"eu2",w:4},{h:"us",w:1},{h:"us1",w:1},{h:"us2",w:1},{h:"us3",w:1}]},{name:"电信",hosts:[{h:"eu",w:1},{h:"eu1",w:1},{h:"eu2",w:1}]},{name:"联通",hosts:[{h:"us",w:1},{h:"us1",w:1},{h:"us2",w:1},{h:"us3",w:1}]}],n=[],i=[],r=0;return{getServsLen:function(){return t.length},getHostsLen:function(){return n.length},getLiveHostsLen:function(){return r},init:function(u){var f=0;typeof u!="undefined"&&u<t.length&&(f=u);n=t[f].hosts;$.each(n,function(n,t){t.w<=0?i.push(n):r++})},getNextTry:function(){return u(i)},isdown:function(t){return typeof t=="undefined"||t==null||t<0||t>n.length||n[t].w<=0},getCurHost:function(){var t=f(n);return i.push(t),t},getHostName:function(t){return n[t].h},getServName:function(n){return t[n].name}}}();
